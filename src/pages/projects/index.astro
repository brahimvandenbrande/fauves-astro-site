---
// src/pages/projects/index.astro
import Layout from "@layouts/Layout.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import Navigation from "@components/Navigation.astro";
import Footer from "@components/Footer.astro";
import { Image } from "astro:assets";

// Import all project images statically with correct relative paths
import portfolioAnm from "../../assets/projects/portfolio-anm.jpg";
import portfolioTat from "../../assets/projects/portfolio-tat.jpg";

// Type the projects array
type Project = CollectionEntry<"projects">;

// Get all projects, sorted by date (newest first)
const projects: Project[] = (await getCollection("projects")).sort(
  (a: Project, b: Project) => b.data.date.getTime() - a.data.date.getTime()
);

// Map project slugs to their corresponding imported images
const projectImages: Record<string, ImageMetadata> = {
  anm: portfolioAnm,
  tat: portfolioTat
};

// Enhanced structured data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  itemListElement: projects.map((project: Project, index: number) => ({
    "@type": "ListItem",
    position: index + 1,
    item: {
      "@type": "CreativeWork",
      name: project.data.title,
      description: project.data.description,
      url: `/projects/${project.slug}/`,
      image: project.data.image?.src
    }
  }))
};
---

<Layout
  title="Our Projects | FAUVES"
  description="Explore our portfolio of branding and design projects."
>
  <Navigation />

  <main class="min-h-screen bg-white">
    <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1
          class="text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl md:text-6xl"
        >
          Our Projects
        </h1>
        <p class="mx-auto mt-6 max-w-2xl text-xl text-gray-500">
          Discover our latest work in branding, design, and digital experiences.
        </p>
      </div>

      <div
        class="mx-auto mt-16 grid max-w-2xl auto-rows-fr grid-cols-1 gap-8 sm:mt-20 lg:mx-0 lg:max-w-none lg:grid-cols-3"
      >
        {
          projects.map((project) => {
            const image = projectImages[project.slug];

            return (
              <article
                class="group relative flex flex-col overflow-hidden rounded-lg shadow-lg transition-shadow hover:shadow-xl dark:shadow-zinc-900/50"
                itemscope
                itemtype="https://schema.org/CreativeWork"
              >
                <div class="relative h-48 w-full overflow-hidden">
                  {image ? (
                    <Image
                      src={image}
                      alt={
                        project.data.image?.alt ||
                        `Project ${project.data.title}`
                      }
                      class="h-full w-full object-cover"
                      width={800}
                      height={600}
                      loading="lazy"
                    />
                  ) : (
                    <div class="flex h-full items-center justify-center bg-gray-100">
                      <span class="text-gray-400">Image not available</span>
                    </div>
                  )}
                </div>
                <div class="flex flex-1 flex-col p-6">
                  <div class="flex-1">
                    <h2
                      class="text-xl font-semibold text-gray-900"
                      itemprop="name"
                    >
                      {project.data.title}
                    </h2>
                    <p
                      class="mt-3 text-base text-gray-500"
                      itemprop="description"
                    >
                      {project.data.description}
                    </p>
                  </div>
                  <div class="mt-6">
                    <a
                      href={`/projects/${project.slug}/`}
                      class="text-base font-medium text-indigo-600 hover:text-indigo-500"
                    >
                      View project
                      <span class="ml-1" aria-hidden="true">
                        â†’
                      </span>
                    </a>
                  </div>
                </div>
              </article>
            );
          })
        }
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
