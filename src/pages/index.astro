---
import type { CollectionEntry } from "astro:content";
import { getImage } from "astro:assets";
import WebsiteStructuredData from "@components/WebsiteStructuredData.astro";
import Layout from "@layouts/Layout.astro";
import Navigation from "@components/Navigation.astro";
import video480mp4 from "@assets/videos/fauves-agency-intro_480p.mp4";
import video480webm from "@assets/videos/fauves-agency-intro_480p.webm";
import video720mp4 from "@assets/videos/fauves-agency-intro_720p.mp4";
import video720webm from "@assets/videos/fauves-agency-intro_720p.webm";
import video1080mp4 from "@assets/videos/fauves-agency-intro_1080p.mp4";
import video1080webm from "@assets/videos/fauves-agency-intro_1080p.webm";
import videoPosterImage from "@assets/videos/fauves-agency-intro-poster.jpeg";
import ProjectCarousel from "@components/ui/ProjectCarousel.astro";
import SectionHeader from "@components/ui/SectionHeader.astro";
import VideoPlayer from "@components/ui/VideoPlayer.astro";
import CTABanner from "@components/ui/CTABanner.astro";
import Footer from "@components/Footer.astro";
import { getCollection } from "astro:content";

// Video sources for the VideoPlayer component
const videoSources = [
  {
    src: video1080webm,
    type: "video/webm",
    media: "(min-width: 1024px)"
  },
  {
    src: video1080mp4,
    type: "video/mp4",
    media: "(min-width: 1024px)"
  },
  {
    src: video720webm,
    type: "video/webm",
    media: "(min-width: 640px)"
  },
  {
    src: video720mp4,
    type: "video/mp4",
    media: "(min-width: 640px)"
  },
  { src: video480webm, type: "video/webm" },
  { src: video480mp4, type: "video/mp4" }
];

// Get all projects, sorted by date (newest first)
const allProjects = (await getCollection("projects")).sort(
  (a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) =>
    b.data.date.getTime() - a.data.date.getTime()
);

// Get featured projects (where featured: true)
const featuredProjects = allProjects.filter(
  (project: CollectionEntry<"projects">) => project.data.featured
);

// Get the optimized image URL
const optimizedPoster = await getImage({
  src: videoPosterImage,
  width: 1200,
  height: 675,
  format: "webp",
  quality: 80
});

// ... (rest of your frontmatter)
---

<Layout
  title="Home"
  description="FAUVES ‚Äì studio de branding et narration de marque."
>
  <WebsiteStructuredData slot="structured-data" />

  <!-- üéØ Contenu principal de la page -->
  <main class="mx-auto flex max-w-[85rem] flex-col gap-12 px-4 pt-24 pb-16">
    <!-- ü¶Å Hero section -->
    <section>
      <SectionHeader
        level={1}
        size="xl"
        align="left"
        id="main-heading"
        class="w-full max-w-[78.614rem]"
      >
        Nous cr√©ons des <span class="font-semibold">marques vivantes</span>.
        Pens√©es pour s'activer, cr√©er de l'impact et √©voluer avec vous.
      </SectionHeader>
    </section>

    <!-- Ancre MESURE (dans le m√™me flux que le texte) -->
    <div id="grid-left-anchor" class="m-0 h-0 p-0"></div>

    <!-- üîπ Wrapper full‚Äëbleed uniquement pour le carrousel -->
    <div
      class="overflow-visible md:-mr-[calc(50vw-50%)] md:-ml-[calc(50vw-50%)] md:w-screen"
    >
      <ProjectCarousel projects={featuredProjects} />
    </div>

    <section class="mx-auto max-w-6xl pt-16 pb-16 text-center">
      <p class="font-degular text-[4rem] leading-[4rem] font-light text-black">
        Vous cherchez √† inspirer autant qu'√† performer‚ÄØ? Chez FAUVES, nous
        donnons vie √†
        <span class="font-semibold">des identit√©s fortes</span>, des r√©cits qui
        r√©sonnent et des marques qui engagent.
      </p>
    </section>

    <VideoPlayer
      title="FAUVES Agency Visual Presentation"
      description="Animated showcase of FAUVES Agency's work and creative process."
      sources={videoSources}
      poster={optimizedPoster.src}
    />

    <section class="mx-auto max-w-[85rem] pt-16 pb-16 text-left">
      <p class="font-degular text-[4rem] leading-[4rem] font-light text-black">
        Notre agence de branding & storytelling centralise et prend en charge
        l‚Äôensemble de vos besoins, de votre positionnement au d√©ploiement de
        votre marque.
      </p>
    </section>
  </main>

  <CTABanner 
    title="Pr√™t √† donner vie √† votre marque ?"
    description="Contactez-nous pour discuter de votre projet et voir comment nous pouvons vous aider √† cr√©er une marque qui se d√©marque."
    buttonText="NOUS CONTACTER"
    buttonHref="/contact"
  />

  <Footer />
</Layout>
