---
import type { CollectionEntry } from "astro:content";
import { getImage } from "astro:assets";
import WebsiteStructuredData from "@components/WebsiteStructuredData.astro";
import Layout from "@layouts/Layout.astro";
import Navigation from "@components/Navigation.astro";
import Footer from "@components/Footer.astro";
import video480mp4 from "@assets/videos/fauves-agency-intro_480p.mp4";
import video480webm from "@assets/videos/fauves-agency-intro_480p.webm";
import video720mp4 from "@assets/videos/fauves-agency-intro_720p.mp4";
import video720webm from "@assets/videos/fauves-agency-intro_720p.webm";
import video1080mp4 from "@assets/videos/fauves-agency-intro_1080p.mp4";
import video1080webm from "@assets/videos/fauves-agency-intro_1080p.webm";
import videoPosterImage from "@assets/videos/fauves-agency-intro-poster.jpeg";
import ProjectCarousel from "@components/ProjectCarousel.astro";
import { getCollection } from "astro:content";

// Get all projects, sorted by date (newest first)
const allProjects = (await getCollection("projects")).sort(
  (a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) =>
    b.data.date.getTime() - a.data.date.getTime()
);

// Get featured projects (where featured: true)
const featuredProjects = allProjects.filter(
  (project: CollectionEntry<"projects">) => project.data.featured
);

// Get the optimized image URL
const optimizedPoster = await getImage({
  src: videoPosterImage,
  width: 1200,
  height: 675,
  format: "webp",
  quality: 80
});

// ... (rest of your frontmatter)
---

<Layout
  title="Home"
  description="FAUVES ‚Äì studio de branding et narration de marque."
>
  <WebsiteStructuredData slot="structured-data" />

  <!-- üß≠ Navigation principale -->
  <header role="banner">
    <Navigation />
  </header>

  <!-- üéØ Contenu principal de la page -->
  <main class="mx-auto flex max-w-[85rem] flex-col gap-12 px-4 pt-24 pb-16">
    <!-- ü¶Å Hero principal -->
    <section>
      <h1
        class="text-h1 leading-h1 font-degular w-full max-w-[75.6rem] pb-[4rem] font-light text-black"
      >
        Ici, nous cr√©ons des <span class="font-semibold">marques vivantes</span
        >. Activables, utiles et qui √©voluent avec vous.
      </h1>
    </section>

    <!-- Projects Carousel -->
    <ProjectCarousel projects={featuredProjects} />

    <section class="mx-auto max-w-6xl pt-16 pb-16 text-center">
      <p class="font-degular text-[4rem] leading-[4rem] font-light text-black">
        Vous cherchez √† inspirer autant qu‚Äô√† performer‚ÄØ? Chez FAUVES, nous
        donnons vie √†
        <span class="font-semibold">des identit√©s fortes</span>, des r√©cits qui
        r√©sonnent et des marques qui engagent.
      </p>
    </section>

    <section
      class="relative mx-auto aspect-video w-full max-w-[85rem] overflow-hidden rounded-xl bg-black"
      aria-label="FAUVES Agency visual presentation"
    >
      <div class="sr-only">
        <h2>FAUVES Agency Visual Presentation</h2>
        <p>Animated showcase of FAUVES Agency's work and creative process.</p>
      </div>
      <video
        aria-hidden="true"
        autoplay
        muted
        playsinline
        loop
        preload="metadata"
        class="h-full w-full object-cover"
        poster={optimizedPoster.src}
      >
        <source
          src={video1080webm}
          type="video/webm"
          media="(min-width: 1024px)"
        />
        <source
          src={video1080mp4}
          type="video/mp4"
          media="(min-width: 1024px)"
        />
        <source
          src={video720webm}
          type="video/webm"
          media="(min-width: 640px)"
        />
        <source src={video720mp4} type="video/mp4" media="(min-width: 640px)" />
        <source src={video480webm} type="video/webm" />
        <source src={video480mp4} type="video/mp4" />
        <!-- No fallback needed as the video is purely decorative -->
      </video>
    </section>

    <section class="mx-auto max-w-[85rem] pt-16 pb-16 text-left">
      <p class="font-degular text-[4rem] leading-[4rem] font-light text-black">
        Notre agence de branding & storytelling centralise et prend en charge
        l‚Äôensemble de vos besoins, de votre positionnement au d√©ploiement de
        votre marque.
      </p>
    </section>
  </main>
</Layout>

<!-- üß† Autres sections (valeurs, m√©thode, clients, etc.) -->
<!-- <section>...</section> -->

<!-- ü¶∂ Pied de page (optionnel) -->
<footer>
  <Footer />
</footer>
